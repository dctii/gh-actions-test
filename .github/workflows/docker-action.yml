# ./.github/workflows/docker-action.yml
name: Docker Actions Test
run-name: ${{ github.actor }} is testing out Custom Docker Action ðŸš€
on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths: # if activity in this folder or file, permitted. paths-ignore is the opposite
      - '.github/workflows/docker-action.yml'
      - '.github/actions/docker-action'

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      UPLOAD_ARTIFACTS: true
    steps:
      # Get code from repo
      - name: Get code
        uses: actions/checkout@v3

      # NOTE: Docker action here
      - name: Run custom docker action for a locust test run
        id: docker-runner
        uses: ./.github/actions/docker-action
        with:
          host: 'https://smallbra.in'
          locustfile: 'locustfile.py'
          users: 2
          spawn-rate: 1
          run-time: 2s

      - name: Print the JSON_DIR and CURR_TIME outputs"
        run: |
          echo "JSON Directory: ${{ steps.docker-runner.outputs.JSON_DIR }}"
          echo "Start Time: ${{ steps.docker-runner.outputs.CURR_TIME }}"